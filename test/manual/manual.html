<!DOCTYPE html>

<head>
    <title>BTN Manual Test</title>
</head>

<body>
    <style>
        #console-area{
            margin:auto;
            margin-top: 2em;
            width:80%;
            height: 15em;
            overflow-y: scroll;
            overflow-x: inherit;
            background: rgb(66, 66, 66);
            color: white;
        }
        #console-area .error {
            color: rgb(255, 98, 98);
        }
        #console-area a {
            color:inherit;
        }
    </style>

    <div id="button-area">
    </div>

    <div id="console-area"></div>

    <h3>How to test positive scenario:</h3>
    <ul>
        <li>Open this page in the most popular browsers for your device type.</li>
        <li>Make sure you have a wallet that supports BIP21 deep links!</li>
        <li>Did your OS ask you to open your wallet?</li>
        <li>Did the circle in the button become green?</li>
        <li>Did any errors apear in the console (the black box)?</li>
        <li>Take a screenshot of what happened.</li>
    </ul>
    <h3>How to test negative scenario:</h3>
    <ul>
        <li>Open this page in the most popular browsers for your device type.</li>
        <li>Make sure you <u>DO NOT HAVE</u> a wallet that supports BIP21 deep links!</li>
        <li>Did a modal window open to tell you of alternative ways to continue?</li>
        <li>If you are on desktop, did the it contain a valid QR code?</li>
        <li>If you are on mobile, was the QR code hidden?</li>
        <li>Did the circle in the button become red?</li>
        <li>Did any errors apear in the console (the black box)?</li>
        <li>Take a screenshot of what happened.</li>
    </ul>

    <script src="../../src/bitbtn.js"></script>

    <script>
        btnArea = document.getElementById("button-area");

        btn = bitbtn.create(btnArea,
            {
                label: "Pay!",
                address: "1CiesvEUNg9sVm8ekhMrGyATvEnH5YU9wh",
                amount: 1.247,
                currency: "USD",
                onError: function (error) { console.log(error); },
            });
    </script>

    <script>
        (function(){
            var defaultLog = console.log;
            var defaultErr = console.error;

            var consoleArea = document.getElementById("console-area");

            consoleArea.appendLine = function(args, lineClass) {
                var line = document.createElement("div");
                line.classList.add(lineClass);
                for(var i = 0; i<args.length; i++) {
                    line.append(args[i] + " ");
                }
                consoleArea.appendChild(line);
            };

            console.log = function(){
                defaultLog.apply(this, arguments);
                consoleArea.appendLine(arguments, "log");
            };
            console.error = function(){
                defaultErr.apply(this, arguments);
                consoleArea.appendLine(arguments, "error");
            };

            window.onerror = function(errorMsg, url, lineNumber) {
                var line = document.createElement("div");
                line.classList.add("error");
                line.innerHTML = "[ERROR] '" + errorMsg + "' in <a href='"+url+"'>"
                    + url.substring(url.lastIndexOf("/"))+"</a> : line " + lineNumber
                consoleArea.appendChild(line);
            };

            function addLoggingToBtn(btn){
                var oldClick = btn.onclick;
                btn.onclick = function() {
                    console.log("[EVENT] BitBtn Clicked!");
                    oldClick.apply(this, arguments);
                };
            }

            var bitBtns = document.getElementsByClassName("bitbtn");
            for(var b in bitBtns){
                addLoggingToBtn(bitBtns[b]);
            }
        }());

    </script>
</body>

</html>